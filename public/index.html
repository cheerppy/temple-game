<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>豚小屋に入らずんば子豚を得ず - 恐怖の豚男</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- 接続状態表示 -->
    <div id="connection-status" class="connection-status">接続中...</div>
    
    <!-- プレイヤー名表示 -->
    <div id="player-name-display" class="player-name-display" style="display: none;">
        プレイヤー: <span id="my-name"></span>
    </div>

    <!-- 観戦者表示 -->
    <div id="spectator-indicator" class="spectator-indicator" style="display: none;">
        👁️ 観戦中
    </div>

    <!-- ゲーム中のルームID表示 -->
    <div id="game-room-id" class="game-room-id" style="display: none;">
        ルームID: <span id="game-room-id-text"></span>
    </div>

    <div class="container">
        <!-- モバイル対応ヘッダー -->
        <div class="header">
            <!-- PCサイズのタイトル -->
            <div class="title-desktop">
                <h1>🐷 豚小屋に入らずんば子豚を得ず 🐷</h1>
                <div class="subtitle">恐怖の豚男 - 多人数推理ゲーム</div>
            </div>
            <!-- モバイルサイズのタイトル -->
            <div class="title-mobile">
                <h1>🐷 豚小屋探検隊 🐷</h1>
                <div class="subtitle">豚男からの脱出</div>
            </div>
        </div>

        <!-- エラーメッセージ -->
        <div id="error-message" class="error-message" style="display: none;"></div>

        <!-- ロビー画面 -->
        <div id="lobby" class="screen">
            <!-- ルール説明 -->
            <div class="info-box">
                <div class="rule-toggle">
                    <button id="toggle-rules" class="btn btn-small" onclick="toggleRules()">📋 ルールを表示/非表示</button>
                </div>
                <div id="rules-content" style="display: none;">
                    <h3>🎯 ゲームの目的</h3>
                    <ul class="rules-list">
                        <li><strong>⛏️ 探検家チーム:</strong> 豚に変えられた子供たち（財宝）を全て救出する</li>
                        <li><strong>🐷 豚男チーム:</strong> 罠を発動させるか、4ラウンド終了まで子供たちを隠し続ける</li>
                    </ul>
                    <h3>📋 ゲームの流れ</h3>
                    <ul class="rules-list">
                        <li>各プレイヤーに5枚のカードが配られる</li>
                        <li>鍵を持つプレイヤーが他の人のカードを1枚選んで公開</li>
                        <li>公開されたプレイヤーに鍵が移る</li>
                        <li>全員が1回ずつカードを公開されたらラウンド終了</li>
                        <li>次のラウンドでは配布枚数が1枚減る</li>
                    </ul>
                </div>
            </div>

            <!-- ルーム操作 -->
            <div class="room-controls">
                <!-- ルーム作成 -->
                <div class="control-section">
                    <h3>🏠 新しいルームを作成</h3>
                    <div class="input-group">
                        <label for="player-name-create">プレイヤー名:</label>
                        <input type="text" id="player-name-create" placeholder="あなたの名前を入力">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="use-password">
                        <label for="use-password">パスワードを設定する</label>
                    </div>
                    <div id="password-group" class="input-group" style="display: none;">
                        <label for="room-password">パスワード:</label>
                        <input type="password" id="room-password" placeholder="パスワードを入力">
                    </div>
                    <button id="create-room" class="btn">ルームを作成</button>
                </div>

                <!-- ルーム参加 -->
                <div class="control-section">
                    <h3>🚪 既存のルームに参加</h3>
                    <div class="input-group">
                        <label for="player-name-join">プレイヤー名:</label>
                        <input type="text" id="player-name-join" placeholder="あなたの名前を入力">
                    </div>
                    <div class="input-group">
                        <label for="room-id-input">ルームID:</label>
                        <input type="text" id="room-id-input" placeholder="6桁のルームID" maxlength="6">
                    </div>
                    <div id="join-password-group" class="input-group" style="display: none;">
                        <label for="join-password">パスワード:</label>
                        <input type="password" id="join-password" placeholder="パスワードを入力">
                    </div>
                    <button id="join-room" class="btn">ルームに参加</button>
                </div>

                <!-- 再入場 -->
                <div class="control-section">
                    <h3>🔄 ゲームに再入場</h3>
                    <div class="input-group">
                        <label for="rejoin-player-name">プレイヤー名:</label>
                        <input type="text" id="rejoin-player-name" placeholder="元のプレイヤー名">
                    </div>
                    <div class="input-group">
                        <label for="rejoin-room-id">ルームID:</label>
                        <input type="text" id="rejoin-room-id" placeholder="6桁のルームID" maxlength="6">
                    </div>
                    <button id="rejoin-room" class="btn">再入場</button>
                </div>

                <!-- 観戦 -->
                <div class="control-section">
                    <h3>👁️ ゲームを観戦</h3>
                    <div class="input-group">
                        <label for="spectator-name">観戦者名:</label>
                        <input type="text" id="spectator-name" placeholder="観戦者名を入力">
                    </div>
                    <div class="input-group">
                        <label for="spectate-room-id">ルームID:</label>
                        <input type="text" id="spectate-room-id" placeholder="6桁のルームID" maxlength="6">
                    </div>
                    <button id="spectate-room" class="btn">観戦開始</button>
                </div>
            </div>

            <!-- 統合されたゲーム一覧 -->
            <div class="games-list">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3>🎮 ゲーム一覧</h3>
                    <div class="refresh-buttons">
                        <button id="refresh-rooms" class="btn btn-small">🔄 更新</button>
                        <button id="toggle-game-view" class="btn btn-small">📋 表示切替</button>
                    </div>
                </div>
                
                <!-- 待機中のルーム -->
                <div id="waiting-rooms-section">
                    <h4 class="section-title">📝 待機中のルーム</h4>
                    <div id="room-list-container">読み込み中...</div>
                </div>
                
                <!-- 進行中のゲーム -->
                <div id="ongoing-games-section">
                    <h4 class="section-title">🎯 進行中のゲーム</h4>
                    <div id="ongoing-games-container">読み込み中...</div>
                </div>
            </div>
        </div>

        <!-- ルーム情報画面 -->
        <div id="room-info" class="room-info">
            <div class="room-id-display">
                ルームID: <span id="room-id-display"></span>
            </div>
            
            <div class="players-list">
                <h3>🧑‍🤝‍🧑 プレイヤー (<span id="player-count">0</span>/10)</h3>
                <div id="players-list"></div>
            </div>

            <div class="room-buttons">
                <button id="start-game" class="btn btn-primary" style="display: none;">ゲーム開始</button>
                <button id="leave-room" class="btn btn-secondary">ルームを退室</button>
            </div>

            <!-- 一時退出セクション -->
            <div id="temp-leave-section" class="temp-leave-section" style="display: none;">
                <div class="temp-leave-info">
                    <h4>⚠️ ゲーム中の退室</h4>
                    <p>• <strong>一時退出:</strong> 同じプレイヤー名とルームIDで再入場できます</p>
                    <p>• <strong>完全退室:</strong> ゲームから永久に離脱します</p>
                    <p>• 一時退出の場合、ゲームは継続されます</p>
                </div>
                <div class="temp-leave-buttons">
                    <button id="temp-leave-room" class="btn btn-secondary">一時退出</button>
                    <button id="cancel-temp-leave" class="btn">キャンセル</button>
                </div>
            </div>
        </div>

        <!-- ゲーム画面 -->
        <div id="game-board" class="game-board">
            <!-- ゲーム情報概要 -->
            <div class="collapsible-section">
                <button class="section-toggle" onclick="toggleSection('game-overview')">
                    📊 ゲーム情報 <span>▼</span>
                </button>
                <div id="game-overview" class="game-overview">
                    <div class="overview-grid">
                        <div>
                            <h4>人数構成</h4>
                            <p id="role-possibility-text">-</p>
                        </div>
                        <div>
                            <h4>カード構成</h4>
                            <p id="card-distribution-text">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 進捗バー -->
            <div class="progress-bars">
                <div class="treasure-progress">
                    <span>💰 子豚:</span>
                    <div class="icon-row" id="treasure-icons"></div>
                    <span style="margin-left: 10px;"><span id="treasure-found">0</span>/<span id="treasure-goal">7</span></span>
                </div>
                <div class="trap-progress">
                    <span>💀 罠:</span>
                    <div class="icon-row" id="trap-icons"></div>
                    <span style="margin-left: 10px;"><span id="trap-triggered">0</span>/<span id="trap-goal">2</span></span>
                </div>
            </div>

            <!-- モバイル用コンパクト情報 -->
            <div class="game-info mobile-compact">
                <div class="info-row">
                    <div class="info-item">
                        <div class="label">ラウンド</div>
                        <div class="value" id="current-round">1</div>
                    </div>
                    <div class="info-item">
                        <div class="label">手札</div>
                        <div class="value" id="cards-per-player">5</div>
                    </div>
                    <div class="info-item">
                        <div class="label">公開済</div>
                        <div class="value" id="cards-flipped">0</div>
                    </div>
                </div>
            </div>

            <!-- 役職表示 -->
            <div id="role-reveal" class="role-card compact">
                <div class="role-header">
                    <div class="role-emoji">🤔</div>
                    <div class="role-info">
                        <div id="player-role">役職確認中...</div>
                        <p id="role-description">-</p>
                    </div>
                </div>
            </div>

            <!-- 鍵保持者情報 -->
            <div class="key-holder-message compact">
                <div class="key-info">
                    <span>🗝️ 鍵の所持者: <strong id="key-holder-name">-</strong></span>
                </div>
                <p class="turn-status" id="turn-message">待機中...</p>
            </div>

            <!-- 自分のカード -->
            <div class="my-cards-section">
                <div class="section-header">
                    <h3>🃏 自分の手札</h3>
                    <div class="card-info">
                        💰<span id="my-treasure">0</span> 💀<span id="my-trap">0</span> 🏠<span id="my-empty">0</span>
                    </div>
                </div>
                <div id="my-cards-grid" class="my-cards-grid mobile-optimized"></div>
            </div>

            <!-- 他プレイヤーのカード -->
            <div class="other-players-section">
                <h3>👥 他のプレイヤー</h3>
                <div id="other-players-container"></div>
            </div>

            <!-- チャット -->
            <div class="chat-section">
                <div class="chat-container mobile">
                    <div id="chat-container"></div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="メッセージを入力..." maxlength="100">
                        <button id="send-chat" class="btn btn-small">送信</button>
                    </div>
                </div>
            </div>

            <!-- ゲーム中退室ボタン -->
            <div class="game-leave-section">
                <button id="game-leave-room" class="btn btn-secondary">退室</button>
            </div>
        </div>

        <!-- 勝利画面 -->
        <div id="victory-screen" class="victory-screen">
            <div class="victory-content">
                <h2 id="victory-title">ゲーム終了</h2>
                <p id="victory-message">-</p>
                <div id="winners-list"></div>
                <button id="return-to-lobby" class="btn">ロビーに戻る</button>
            </div>
        </div>

        <!-- ラウンド開始演出 -->
        <div id="round-start-overlay" class="round-start-overlay">
            <div class="round-start-text">
                <h1 id="round-start-message">ラウンド開始</h1>
            </div>
        </div>

        <!-- プレイヤー名入力モーダル -->
        <div id="name-input-modal" class="name-input-modal">
            <div class="name-input-content">
                <h3>プレイヤー名を入力</h3>
                <div class="input-group">
                    <input type="text" id="modal-player-name" placeholder="あなたの名前を入力">
                </div>
                <div class="name-input-buttons">
                    <button id="modal-join-btn" class="btn btn-primary">参加</button>
                    <button id="modal-cancel-btn" class="btn btn-secondary">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/socketClient.js"></script>
    <script src="/js/game.js"></script>

    <script>
        // ルール表示切り替え
        function toggleRules() {
            const content = document.getElementById('rules-content');
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
        }

        // セクション折りたたみ
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('collapsed');
        }

        // ゲーム表示切り替え
        document.getElementById('toggle-game-view').addEventListener('click', function() {
            const waitingSection = document.getElementById('waiting-rooms-section');
            const ongoingSection = document.getElementById('ongoing-games-section');
            
            if (waitingSection.style.display === 'none') {
                waitingSection.style.display = 'block';
                ongoingSection.style.display = 'block';
                this.textContent = '📋 表示切替';
            } else {
                // どちらを表示するかトグル
                if (waitingSection.classList.contains('hidden')) {
                    waitingSection.classList.remove('hidden');
                    ongoingSection.classList.add('hidden');
                    this.textContent = '🎯 進行中';
                } else {
                    waitingSection.classList.add('hidden');
                    ongoingSection.classList.remove('hidden');
                    this.textContent = '📝 待機中';
                }
            }
        });
    </script>
</body>
</html>
