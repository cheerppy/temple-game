<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚°ç”¨æœ€å°æ§‹æˆ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #333; 
            color: white; 
        }
        .debug-info {
            background: #444;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #555;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <h1>Socket.io æ¥ç¶šãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="debug-info">
        <h3>æ¥ç¶šçŠ¶æ…‹</h3>
        <p id="connection-status">æœªæ¥ç¶š</p>
    </div>
    
    <div class="debug-info">
        <h3>DOMè¦ç´ ãƒã‚§ãƒƒã‚¯</h3>
        <p id="dom-check">ãƒã‚§ãƒƒã‚¯ä¸­...</p>
    </div>
    
    <div class="debug-info">
        <h3>æ“ä½œ</h3>
        <button onclick="testConnection()">æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testDOM()">DOMè¦ç´ ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="createRoom()">ãƒ«ãƒ¼ãƒ ä½œæˆãƒ†ã‚¹ãƒˆ</button>
    </div>
    
    <div class="debug-info">
        <h3>ãƒ­ã‚°</h3>
        <div id="log-output" style="background: #222; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
    </div>

    <!-- Socket.io CDN -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <script>
        let socket = null;
        let logs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${message}`);
            const logOutput = document.getElementById('log-output');
            if (logOutput) {
                logOutput.innerHTML = logs.slice(-20).join('<br>');
                logOutput.scrollTop = logOutput.scrollHeight;
            }
            console.log(message);
        }
        
        function updateStatus(status) {
            const statusEl = document.getElementById('connection-status');
            if (statusEl) {
                statusEl.textContent = status;
                statusEl.style.color = status.includes('æ¥ç¶šæ¸ˆã¿') ? '#0f0' : '#f00';
            }
        }
        
        function testConnection() {
            log('Socket.ioæ¥ç¶šã‚’é–‹å§‹...');
            
            try {
                socket = io({
                    transports: ['websocket', 'polling'],
                    timeout: 5000
                });
                
                socket.on('connect', () => {
                    log('âœ… Socket.ioæ¥ç¶šæˆåŠŸï¼');
                    updateStatus('æ¥ç¶šæ¸ˆã¿ - ID: ' + socket.id);
                });
                
                socket.on('disconnect', (reason) => {
                    log('âŒ Socket.ioåˆ‡æ–­: ' + reason);
                    updateStatus('åˆ‡æ–­æ¸ˆã¿');
                });
                
                socket.on('connect_error', (error) => {
                    log('âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + error.message);
                    updateStatus('æ¥ç¶šã‚¨ãƒ©ãƒ¼');
                });
                
                socket.on('roomList', (rooms) => {
                    log('ğŸ“‹ ãƒ«ãƒ¼ãƒ ä¸€è¦§å—ä¿¡: ' + rooms.length + 'ä»¶');
                });
                
            } catch (error) {
                log('âŒ SocketåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }
        
        function testDOM() {
            log('DOMè¦ç´ ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...');
            
            const elements = [
                'connection-status',
                'dom-check',
                'log-output',
                'lobby',
                'room-info',
                'game-board',
                'error-message'
            ];
            
            let found = 0;
            let total = elements.length;
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`âœ… è¦ç´ ç™ºè¦‹: #${id}`);
                    found++;
                } else {
                    log(`âŒ è¦ç´ ä¸æ˜: #${id}`);
                }
            });
            
            const domCheck = document.getElementById('dom-check');
            if (domCheck) {
                domCheck.textContent = `${found}/${total} è¦ç´ ãŒåˆ©ç”¨å¯èƒ½`;
                domCheck.style.color = found === total ? '#0f0' : '#fa0';
            }
        }
        
        function createRoom() {
            if (!socket || !socket.connected) {
                log('âŒ Socketæœªæ¥ç¶š');
                return;
            }
            
            log('ãƒ«ãƒ¼ãƒ ä½œæˆã‚’ãƒ†ã‚¹ãƒˆä¸­...');
            
            socket.emit('createRoom', {
                playerName: 'ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼',
                hasPassword: false,
                password: ''
            });
            
            socket.on('roomCreated', (data) => {
                log('âœ… ãƒ«ãƒ¼ãƒ ä½œæˆæˆåŠŸ: ' + data.roomId);
            });
            
            socket.on('error', (error) => {
                log('âŒ ãƒ«ãƒ¼ãƒ ä½œæˆã‚¨ãƒ©ãƒ¼: ' + error.message);
            });
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®åˆæœŸãƒã‚§ãƒƒã‚¯
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            testDOM();
            
            // Socket.io ãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
            if (typeof io !== 'undefined') {
                log('âœ… Socket.io ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿æ¸ˆã¿');
            } else {
                log('âŒ Socket.io ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        });
        
        // ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ
        window.addEventListener('error', (event) => {
            log('âŒ JavaScript ã‚¨ãƒ©ãƒ¼: ' + event.message + ' (è¡Œ:' + event.lineno + ')');
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            log('âŒ Promise ã‚¨ãƒ©ãƒ¼: ' + event.reason);
        });
    </script>
</body>
</html>
